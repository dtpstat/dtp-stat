# Консольные команды

Список команд доступных через cli [manage.py](./../manage.py)

[manage.py](./../manage.py) (django-admin) - стандартный cli для django приложений который  
может быть расширен разработчиком. [См. офф гайд](https://docs.djangoproject.com/en/3.2/ref/django-admin/) для
стандартных команд.

Для использования команд, нужно иметь развернутую среду.  
Cм. настройку [prod](prod-env.md) и [local](local-env.md) сред.

## Процессинг данных

### Загрузка данных о ДТП

``` 
./manage.py dtp
```

Команда запускает [парсеры](../data/parser), которые настроены на сбор и обработку открытых данных с серверов ГИБДД.
Список загрузок веделется в БД, таким образом, что при повторном парсинге, не происходит загрузки уже загруженных
данных. Эта команда использует внешние данные, может очень долго работать.

На хостинге задача выполняется **по cron-у раз в сутки**

Используется также при холодном старте приложения, чтобы заполнить справочники.

### Обновление открытых данных на сайте

``` 
./manage.py opendata
```

Выполняет выгрузку открытых данных о ДТП и обновляет содиржимое файлов `geojson` на
странице https://dtp-stat.ru/opendata/

Запускается на хостинге **по cron-у раз в сутки**

NOTE: Для выгрузки информации, скрипт обходит всю базу ДТП, так что может потреблять значительное количество ресурсов и
времени.

### Бот для телеграмм канала
``` 
./manage.py bot
``` 

TODO: описать насыщенную жизнь бота


## Служебные команды

### Загрузка фикстур и справочников.

``` 
./manage.py start
``` 

Загружаетв в БД следующие справочники:

* Список регионов
* Список серъезности травм (severity_levels)
* Список типов участников ДТП (participant_types)
* Список тегов

Используется только при первом развертывании. Для загрузки остальны справочников используется
команда [dtp](#Загрузка-данных-о-ДТП)

## Выполнение миграций

``` 
./manage.py migrate
``` 

Раскатывает недостающие миграции на подключенную БД. [См. офф гайд](https://docs.djangoproject.com/en/3.2/ref/django-admin/)

## Непонятное
* `debug_api`  - какое-то легаси
* `debug_get_region` - какое-то легаси
* `fixdata`  - какое-то легаси
* `fix`  - какое-то легаси
* `mapdata`  - какое-то легаси